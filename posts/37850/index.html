<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ip协议 | 陌上花开缓缓归</title><meta name="description" content="ICMP协议ICMP是网络控制消息协议,属于网络层协议,ICMP协议用来在网络设备间传递各种差错和控制信息,并对于收集各种网络信息,诊断和排除各种网络故障等方面起着至关重要的作用.使用基于ICMP的应用时,需要对ICMP的工作原理非常熟悉. 平时用到的ping命令,就是使用的ICMP协议,用来检测网络的连通性(通或者不通问题),通过主机A向主机(服务器),现在想检测主机A与服务器之间的联通性,使用"><meta name="keywords" content="计算机网络"><meta name="author" content="lys-studys"><meta name="copyright" content="lys-studys"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/timg.jpeg"><link rel="canonical" href="http://example.com/posts/37850/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="yandex-verification" content="{&quot;theme_color&quot;:{&quot;enable&quot;:true,&quot;main&quot;:&quot;#49B1F5&quot;,&quot;paginator&quot;:&quot;#00c4b6&quot;,&quot;button_hover&quot;:&quot;#FF7242&quot;,&quot;text_selection&quot;:&quot;#00c4b6&quot;,&quot;link_color&quot;:&quot;#99a9bf&quot;,&quot;meta_color&quot;:&quot;#858585&quot;,&quot;hr_color&quot;:&quot;#A4D8FA&quot;,&quot;code_foreground&quot;:&quot;#F47466&quot;,&quot;code_background&quot;:&quot;rgba(27, 31, 35, .05)&quot;,&quot;toc_color&quot;:&quot;#00c4b6&quot;,&quot;blockquote_padding_color&quot;:&quot;#49b1f5&quot;,&quot;blockquote_background_color&quot;:&quot;#49b1f5&quot;}}"/><meta property="og:type" content="article"><meta property="og:title" content="ip协议"><meta property="og:url" content="http://example.com/posts/37850/"><meta property="og:site_name" content="陌上花开缓缓归"><meta property="og:description" content="ICMP协议ICMP是网络控制消息协议,属于网络层协议,ICMP协议用来在网络设备间传递各种差错和控制信息,并对于收集各种网络信息,诊断和排除各种网络故障等方面起着至关重要的作用.使用基于ICMP的应用时,需要对ICMP的工作原理非常熟悉. 平时用到的ping命令,就是使用的ICMP协议,用来检测网络的连通性(通或者不通问题),通过主机A向主机(服务器),现在想检测主机A与服务器之间的联通性,使用"><meta property="og:image" content="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><meta property="article:published_time" content="2020-12-23T07:57:39.000Z"><meta property="article:modified_time" content="2020-12-27T12:59:20.556Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime: 'days',
  date_suffix: {"one_hour":"Just","hours":"hours ago","day":"days ago"},
  copyright: {"limitCount":50,"languages":{"author":"Author: lys-studys","link":"Link: ","source":"Source: 陌上花开缓缓归","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: {"text":"I,LOVE,YOU","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"Press","message_next":"to bookmark this page"},"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isSidebar: true,
  postUpdate: '2020-12-27 20:59:20'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'true'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="./source/css/background.css"><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="陌上花开缓缓归" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" data-lazy-src="/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">68</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">31</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">Categories</div><div class="length_num">26</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.</span> <span class="toc-text">ICMP协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rqp%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.</span> <span class="toc-text">rqp协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%85%E8%B0%88%E5%8D%8F%E8%AE%AE"><span class="toc-number">3.</span> <span class="toc-text">浅谈协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ARP"><span class="toc-number">3.1.</span> <span class="toc-text">ARP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NAT"><span class="toc-number">3.2.</span> <span class="toc-text">NAT</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ICMP"><span class="toc-number">3.3.</span> <span class="toc-text">ICMP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DHCP"><span class="toc-number">3.4.</span> <span class="toc-text">DHCP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RIP"><span class="toc-number">3.5.</span> <span class="toc-text">RIP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OSPF"><span class="toc-number">3.6.</span> <span class="toc-text">OSPF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BGP"><span class="toc-number">3.7.</span> <span class="toc-text">BGP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#http%E5%8D%8F%E8%AE%AE"><span class="toc-number">4.</span> <span class="toc-text">http协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B0%E5%BA%95%E8%AF%A5%E5%A6%82%E4%BD%95%E7%90%86%E8%A7%A3HTTP%E9%95%BF%E8%BF%9E%E6%8E%A5"><span class="toc-number">4.1.</span> <span class="toc-text">到底该如何理解HTTP长连接</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#https%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.</span> <span class="toc-text">https协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">DNS域名解析详细过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E5%9F%9F%E5%90%8D"><span class="toc-number">6.1.</span> <span class="toc-text">根域名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DNS%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="toc-number">6.2.</span> <span class="toc-text">DNS域名解析协议</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">陌上花开缓缓归</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> message</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">ip协议</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2020-12-23T07:57:39.000Z" title="Created 2020-12-23 15:57:39">2020-12-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2020-12-27T12:59:20.556Z" title="Updated 2020-12-27 20:59:20">2020-12-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h3 id="ICMP协议"><a href="#ICMP协议" class="headerlink" title="ICMP协议"></a>ICMP协议</h3><p>ICMP是网络控制消息协议,属于网络层协议,ICMP协议用来在网络设备间传递各种差错和控制信息,并对于收集各种网络信息,诊断和排除各种网络故障等方面起着至关重要的作用.使用基于ICMP的应用时,需要对ICMP的工作原理非常熟悉.</p>
<p>平时用到的ping命令,就是使用的ICMP协议,用来检测网络的连通性(通或者不通问题),<br>通过主机A向主机(服务器),现在想检测主机A与服务器之间的联通性,使用ICMP协议首先从A主机发送一个message消息到服务器,不管到哪里或者断了,都会回复一个消息(return Message),就可以通过回复的消息来判断中间的网络是怎么样的(ip等路由信息都通过return message来判断),大致流程是这样的.</p>
<p>网关: 用来转发不同网段之间的数据包.<br>如果是主机A想想访问服务器A,就是先判断服务器A的网络ip是不是和服务器的ip属于同一个网段,如果是就直接访问,如果不是就得交给网关进行转发,网关的作用就是转发不同网段之间的数据包.</p>
<p>ICMP重定向:<br>    例子,图:ICMP重定向<br>    主机A判断和服务器A的是不是属于同一个网段，这里判断显然不是，就会通过默认的网关，RTB进行消息转发，转发给了RTA,RTA再找到服务器A,这里的RTB的操作就是冗余的.这种情况下网关(RTB)会返回一个ICMP重定向的消息，告诉主机A,下次的路径.直接可以访问TRA就可已到达．这里所说的RTB那条路径是次优路径，RTA那条路径是次优路径是最优路径．<br>ICMP重定向的作用: 解决了次优路径.(这里只是控制消息还有我们的差错还有查询)</p>
<p>ICMP差错检测<br>图：ICMP差错检测<br>主机A会给主机B发送一个ICMP Echo Requst消息,经过传播到达服务器A ,服务器A 会回复ICMP Rcho Reply的消息．这是正常的情况．<br>如果说没有返回这个消息，就说明出现问题了，</p>
<p>ICMP Echo Requst 和ICANN Echo Reply分别用来查询和响应某些信息，进行差错检测.</p>
<p>ICMP错误报告<br>图 ICMP错误报告<br>主机会给服务器发送消息，中间经过路由器，如果中间出现问题（IP冲突或者没有路由）路由会回复一个信息（ICMP目的不可达）<br>当网络设备无法访问目标网络时，会自动发送ICMP目的不可达报文到发送端设备.</p>
<p>ICMP数据包格式:<br>    1. 帧头<br>    2. 网络头<br>    3. ICMP<br>    4. FCS<br>ICMP中包括:<br>    1. type(0-7)<br>    2. code(7-15)<br>    3. checksum(15-31)<br>ICMP的报文内容(不同类型和代码标识不同的内容)．<br>type表示ICMP消息类型，Code表示同一消息类型中的不同信息．<br>返回的ICMP目的不可达就是通过Type类型和Code值．<br>图　ICMP消息类型和编码类型．<br>网络不可达: 没有路由<br>主机不可达: 主机没有IP或者说IP地址配置错误.<br>协议不可达: acl协议（或者中间设备）给他过滤了．<br>端口不可达: 端口不对外开放.</p>
<p>ICMP应用-ping<br>主动方发送一个ICMP请求，对方发送一个ICMP回应,<br>确认情况下ping一般发送五个请求包，对方会给我们回五个回应．</p>
<p>ICMP应用-Tracert<br>用来跟踪数据包所经过的路径.<br>原理就是控制TTL值，TTL值是用来防环的，如果TTL值为0的时候这个数据包就会被丢弃，而且每经过一次路由器，TTL就会减一.缺省值为255.</p>
<p>运行过程:<br>    开始的时候，主机会把ttl设置为1，发送一个TTL为1的报文,首先主机A会把报文交给网关，网关再次发送给路由器，（在网关TTL为1,发送出去就会变成0,到b路由器判断为0,报文丢弃，返回一个信息(ICMP消息不可达)给主机A）,主机A收到了这个消息，就会知道第一个设备经过的是哪里，下次会再次发送一个TTL为2的报文，以此类推.就可以判断经过的路径.<br>图: icmp应用-Tracert</p>
<p>Tracert: 回复的是ICMP.</p>
<p>模拟机上用的是Tracertroute<br>Tracertroute: 回复的是UDP.</p>
<p>抓包真机上能抓到，模拟器上抓不到icmp重定向.</p>
<h3 id="rqp协议"><a href="#rqp协议" class="headerlink" title="rqp协议"></a>rqp协议</h3><p>在操作系统和网络设备没有或者不需要设置ARP参数.很少用到．<br>有助于故障诊断:<br>    1. 通过ARP包的特征就能判断网络构架是否正确．<br>    2. 有没有发生依赖．<br>    3. 有没有错包<br>    4. 有没有广播分报等信息.</p>
<p>由于ARP本身的缺陷，使其成为内网的安全隐患(ARP协议攻击前边有说过),</p>
<h3 id="浅谈协议"><a href="#浅谈协议" class="headerlink" title="浅谈协议"></a>浅谈协议</h3><h4 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h4><p>Address Resolution Protocol，地址解析协议，根据IP地址获取物理地址。</p>
<p>主机发送信息时将包含目标IP地址的ARP请求广播到网络上的所有主机，并接收返回消息，以此确定目标的物理地址；收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存以节约资源。地址解析协议是建立在网络中各个主机互相信任的基础上的，网络上的主机可以自主发送ARP应答消息，其他主机收到应答报文时不会检测该报文的真实性就会将其记入本机ARP缓存，由此攻击者就可以向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗。</p>
<h4 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h4><p>Network Address Translation，网络地址转换，一种将私有（保留）地址转化为合法IP地址的转换技术。</p>
<p>在专用网内部的一些主机本来已经分配到了本地IP地址（即仅在本专用网内使用的专用地址），但又想和因特网上的主机通信时，可使用NAT方法。这种方法需要在专用网连接到因特网的路由器上安装NAT软件。装有NAT软件的路由器叫做NAT路由器，它至少有一个有效的外部全球IP地址。这样，所有专用网内部的想和因特网上的主机通信时，都要在NAT路由器上将其本地地址转换成全球IP地址，才能和因特网连接。</p>
<h4 id="ICMP"><a href="#ICMP" class="headerlink" title="ICMP"></a>ICMP</h4><p>Internet Control Message Protocol，Internet控制报文协议，用于在IP主机、路由器之间传递控制消息。</p>
<p>控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。</p>
<h4 id="DHCP"><a href="#DHCP" class="headerlink" title="DHCP"></a>DHCP</h4><p>Dynamic Host Configuration Protocol，动态主机配置协议，是一个局域网的网络协议。</p>
<p>DHCP使用UDP协议工作，主要有两个用途：一是给内部网络或网络服务供应商自动分配IP地址，二是作为用户或者内部网络管理员对所有计算机作中央管理的手段。</p>
<h4 id="RIP"><a href="#RIP" class="headerlink" title="RIP"></a>RIP</h4><p>Routing Information Protocol，路由信息协议，是一个内部网关协议，是一种基于距离矢量的路由协议，以路由跳数作为计数单位的路由协议，适合用于比较小型的网络环境。它选择路由的度量标准是跳数，最大跳数是15跳，如果大于15跳，它就会丢弃数据包。</p>
<h4 id="OSPF"><a href="#OSPF" class="headerlink" title="OSPF"></a>OSPF</h4><p>Open Shortest Path First，开放式最短路径优先，是一个内部网关协议，是对链路状态路由协议的一种实现，用Dijastra算法实现。它选择路由的度量标准是带宽，延迟。</p>
<h4 id="BGP"><a href="#BGP" class="headerlink" title="BGP"></a>BGP</h4><p>Border Gateway Protocol，边界网关协议，是一个外部网关协议，用来连接因特网上的独立系统，在自治系统之间动态交换路由信息。</p>
<h3 id="http协议"><a href="#http协议" class="headerlink" title="http协议"></a>http协议</h3><h4 id="到底该如何理解HTTP长连接"><a href="#到底该如何理解HTTP长连接" class="headerlink" title="到底该如何理解HTTP长连接"></a>到底该如何理解HTTP长连接</h4><p>想要理解HTTP长连接就必须理解socket连接.<br>套接字是什么?<br>Socket是什么?是操作系统提供的tcp协议之上的接口.</p>
<p>这里就会涉及到TCP协议，该协议处在传输层，那么什么来实现TCP协议呢?<br>TCP协议在linux源码中实现了三次握手等操作.也就是说TCP是在os中进行详细实现的.<br>HTTP协议(请求)就是一个特定格式的数据,</p>
<p>重申操作系统会实现TCP协议.</p>
<p>在linux系统内部:<br>建立TCP链接—首先调用tcp_connect()完成三次握手,</p>
<p>HTTP格式:</p>
<p>访问<a target="_blank" rel="noopener" href="https://www.baidu,com/">https://www.baidu,com/</a><br>会默认的设置一个请求头 Connextion:(http 0.9/http 1.0)默认的是close.(如果是http1.1版本的话　就是keepAlive （这里就是长连接)).构造完成请求头，然后发送给百度的服务器．</p>
<p>浏览器步骤:<br>    1. 构造数据(构造成指定格式的数据(HTTP格式)).<br>    2. 调用操作系统的API(所提供的功能.–发送数据的功能—TCP连接.)<br>    3. 基于TCP连接再发送数据.</p>
<p>操作系统是负责传输数据，而数据格式解析等操作都是交给应用程序(浏览器/Tomcat)来完成的．</p>
<p>HTTP的长连接参数为啥是 keep_alive/close这个参数呢?他有什么特殊的含义吗?<br>注意区分(tcp中有一个keep_alive(这个定义的心跳))我么这里所说的是HTTP中的keep_alive.</p>
<p>下边的两行构造出来的就是HTTP请求:<br><a target="_blank" rel="noopener" href="https://www.baidu.com/">https://www.baidu.com/</a><br>Connextion: keep_alive</p>
<p>当我们访问百度的时候我们只向百度服务器只发送了一个HTTP的请求吗?</p>
<p>当我们输入baidu.com的时候，会发出75个HTTP请求,难道会建立75个socket吗?<br>??????<br>如果使用的是HTTP的短连接: 就会建立75个Socket.<br>如果使用的是HTTP长连接:<br>    如果不建立75个Socket,如果建立10个Socket那个这75个HTTP请求如何发呢?</p>
<p>这里就涉及到了多个HTTP请求共用一个Socket连接,一个socket连接能处理多少个HTTP请求，这个在Tomact中会有配置的.</p>
<p>我们想要访问一个服务器就需要先建立socket连接,然后再发送HTTP请求(就是通过Socket发送HTTP类型的数据),Tomcat接受这些数据之后就会处理这些数据,Tomact如何处理这些数据这里就涉及到了长连接,当Tomact接收到这个请求后，就会判断这个请求头中connection:是不是close类型的，如果这个参数是close类型的，Tomact就认为是短连接，如果是短连接Tomact就会先处理完这个请求，总而言之先解析头部，再解析请求，把这个请求的结果的响应给浏览器．在响应头里边也有一个connection的参数短连接的话参数也为close，对于Tomcat请求处理完了就会把socket关掉，对于浏览器当他接收到响应之后,就会渲染页面渲染完成之后，也会把socket关掉,这里就是短连接….close的先后顺序在网络中，不能很好的控制的．<br>双方没有谁主动的问题，只要收到connection:close.就会去主动关闭.</p>
<p>下边说什么是长连接:<br>    如果Connextion参数为keep_alive,当浏览器发送这HTTP请求，Tomact接收到这个请求后，解析出来是keep_alive(保持活跃),<br>    这里的保持活跃说的是，接收到HTTP请求这个socket保持活跃,所以说在Tomcat处理完成之后会给一个反馈信息，这个反馈信息就不会再包含connection:close这个参数了，当前这个socket谁(socket和Tomact)都不会去关，从而使得Socket的(长连接)没有关闭（保持开着的状态),Tomact能同时存在活跃的socket,可以同时有好多个浏览器来连tomcat的8080端口,Tomact会控制有多少个活跃的socket个数，当浏览器在向tomcat建立socket连接的时候，还有一个参数来控制能够来处理多少个HTTP请求，就比如建立了一条长连接的socket(),然后通过这个socket()发送若干次http的请求，参数为maxKeepAliveRequests,就是长连接处理参数的请求,在一次建立socket之后，然后接收HTTP格式(这里都是connection为keep_alive.保持长连接)的请求，假设参数设置为3，就是前两个反馈信息（反馈头部）设置相关闭参数，等收到第三个请求之后，反馈头部就会加上connection:close.这个参数，返回给浏览器，这时Tomcat(服务器)就会调用socket.close()这个方法，然后浏览器收到响应头部这个反馈信息后，也会调用浏览器的socket.close的方法,进而实现套接字的关闭,这个参数的作用到这里解释完毕，注意一下,这个参数的默认参数为100,就是一个Socket连接只能处理100个http请求.</p>
<pre><code>为什么要加上100这个限制呢?一直处理不好吗?
这里涉及到socket中的两个buffer，发送端有sendbuffer, 服务端recvbuffer,这里的buffer是在操作系统里边的，当我们写一个套接字，没有相关的处理数据（写发等）等逻辑，服务端为例，服务端就会把HTTP请求的那些信息暂存于buffer,服务端再进行数据的读取操作，就是从recvbuffer中获取的数据.
我们可以实现一个功能模拟(client)网站连接一个服务端一直发送大量的数据，到达一定的时候他就不会再进行发送了，那么问题来了，客户端怎么知道服务端的buffer满了呢?
这就跟tcp协议有关，就好比是tcp协议中的窗口，服务端每次接受到一个数据或者一组数据，就会返回有一个信息反馈，如果我这里满了就会告诉服务端不要再发了,这个可以手动更改，serversocket.setReceiveBufferSize()来修改这个缓冲区的大小，tomcat从recvbuffer中获取数据的，</code></pre>
<p>最大连接数，这里说的就是socket的连接个数，这里通过控制socket的个数来达到控制最大连接数的，代码底层有一个最大线程数，还有一个最大连接数，这两个区别是什么呢?<br>  最大线程数:　就是线程池的大小．<br>  Tomact中用的是bio的方式，在这种方式下,两者的值是一样的,只有用nio的方式他们连个才会不一样．<br>  bio的方式:<br>      就是我能够同时处理的socket的数量，在线程池开一定数量的线程，比如线程数为100,每个线程开一个socket连接,基于这种方式在bio里边最大连接数和最大线程数是一样的.</p>
<p>Tomact整体读数据的流程:<br>    读取buffer中的数据，字节格式，然后解析http协议,获得请求头部,判断连接方式(connection: keep还是什么)，响应获得一个rquest的对象，然后servle处理这个request的对象，然后会调用socket,output的对象发出响应，然后根据头部解析的结果来判断要不要调用套接字的关闭与否．</p>
<p>Tomact底层是调用的socket的,</p>
<p>setsotimeout()来设置套接字的等待时间，就是想从buffer中拿数据，但是buffer中目前又不存在数据，所以说要等多久，这里就是我们设置的这个时间，这就是会阻塞的原因.如果说Tomcat也想设置socket这个参数该怎么办呢，就要设置keepAliveTimeout这个函数了，如果时间到了，还是没有读到，Tomcat就会调用套接字的close方法.</p>
<p>Tomact长连接就是读完最后一次数据的20秒后关闭socket.<br>图:Tomact请求过程</p>
<p>如果七个HTTP请求访问jsp页面，会反馈多少个HTTP请求?(Google浏览器)<br>会反会9个HTTP,第一个为index.jsp返回jsp页面，后续七个为servletDemo? = 1直到等于7,最后会默认发送一个图标,favicon.ico．那么一共建立了几个socket连接呢? 这个显示了6个socket连接，问题来了，这个6从哪里来的，是Tomact还是浏览器哪个设置的.<br>这个6是浏览器设置的,浏览器是客户端,就是拿到一个网页，其中有7个请求，一个浏览器也能同时建立多个socket,谷歌里边默认会建立六个，这就是浏览器并发请求的数量,这里有9个HTTP请求，六个socket这里就必然会涉及到共享，哪几个http请求用的是同一个socket,第一个请求必然会建立一个socket连接，发送完反馈信息之后，再发送第二http请求的时候有必要再建立一个socket呢？没有必要，这里就可以看出前两个.js和http1用的是同一个socket连接,第三个(http2)这个请求会建立新的socket，那么第四个会不会新建立一个呢？不一定的,其他几个HTTP就会并发的建立socket来发送http请求．这只是一种情况，第一个和第二个会通过一个socket来发送数据，而下边几个http请求，可能会占用同一个socket也可能自己新创建,并发的执行，谁跟谁用一个socket我们没有办法确定的.</p>
<p>注意: 如果在频繁的建立连接的过程过程中，也可能会用到同一个socket．<br>学完这个完成:<br>可用在项目中的jvm,mysql,Tomact调优. </p>
<p>参数: keepAliveTimeout,maxConnections,maxKeepAliveRequests的作用</p>
<h3 id="https协议"><a href="#https协议" class="headerlink" title="https协议"></a>https协议</h3><h3 id="DNS域名解析详细过程"><a href="#DNS域名解析详细过程" class="headerlink" title="DNS域名解析详细过程"></a>DNS域名解析详细过程</h3><h4 id="根域名"><a href="#根域名" class="headerlink" title="根域名"></a>根域名</h4><p>ICANN公司(US)来负责管理顶级域名比如说是(.com).<br>一般的话给这些域名分为两类:<br>    1. 一般的(.com)(.net)(.org)大概700个.<br>    2. 国别(.cn 中国)(.uk)英国,大概200个.</p>
<p>ICANN不会亲自管理这些域名,每一个域名有一个托管商,由托管商来管理这些域名的具体管理事项.<br>ICANN会将所有事物都委托给管商,(.cn)就是中国互联网网络信息中心(CNNIC),最大的托管商verisign,ICANN是非盈利组织, verisign是商业公司托管有((.com)(.net)(.tv)),</p>
<p>下面说域名注册费用问题:<br>    比如注册(.com)的费用,10美元.<br>    ICANN : 0.8美元.<br>    verisign: 7.85美元.<br>    注册商: 剩余的.</p>
<p>verisign几乎的垄断利润,ICANN通过发布新的域名,反垄断.</p>
<p>根域名:<br>    <a target="_blank" rel="noopener" href="http://www.abc.com.注意com后边有一个点,这个就是根域名,因为所有的域名都有根域名,所以这个点(根域名)被隐藏了/">www.abc.com.注意com后边有一个点,这个就是根域名,因为所有的域名都有根域名,所以这个点(根域名)被隐藏了</a>.</p>
<p>细说一下: <a target="_blank" rel="noopener" href="http://www.abc.com.的访问过程/">www.abc.com.的访问过程</a>:<br>    1. 查询根域名得到.com顶级域名的服务器地址.<br>    2. 查询顶级域名得到.abc次级域名的服务器地址.<br>    3. 最后通过查询次级域名,得到了ip地址.<br>INACC: 在这里的作用是维护了一个列表维护了所有的顶级域名服务器地址,这个列表名叫DNS根区,保存这个文件的服务器就是根域名服务器,全世界目前有13台根域名节点,分别是a.root-servers.net…m.root-servers.net(就是a 到 m).为什么是13台,因为早期的DNS解析结果是512字节的数据包,数据包只能容纳13台服务器的地址,现在13台服务器由12家组织独立运营,每家组织为了保持根域名的稳定性,在每个编号下边都会运行很多台机器,现在世界有五百多台机器用于根节点的查询,</p>
<h4 id="DNS域名解析协议"><a href="#DNS域名解析协议" class="headerlink" title="DNS域名解析协议"></a>DNS域名解析协议</h4><p>图 域名解析图</p>
<p>我们输入浏览器的是域名,但是电脑是通过IP访问的,这里就需要有一个地址簿(域名IP对应表),电脑能通过域名来查询到对应的IP.电脑拿到IP之后再去访问网站,这里所说的地址簿就是DNS服务器.</p>
<p>知识储备根域名的知识:</p>
<p>DNS服务器:<br>    相关设计:<br>        由于需求是人都能上网,并且这些人都分布在世界各地,所以对服务器的要求是高可用,分布式(满足世界各地).在这种要求下DNS服务器就被设计成了树状结构:<br>            根: 用点来表示(.)<br>            跟下边是若干顶级域名,常见的顶级域名:<br>                (.com), (.cn), (.net),<br>            顶级域名解析服务器就是返回权威DNS域名解析服务器.权威域名:<br>                (baidu.com),(163.com)<br>            权威域名解析服务器就能返回具体的域名对应的IP地址.比如<a target="_blank" rel="noopener" href="http://www.163.com的ip地址/">www.163.com的ip地址</a>,<br>            网络运营商会就近部署一些缓存域名服务器,如果缓存中有IP就直接返回,就不用到根域名,顶级域名,和权威域名解析服务器上进行逐级解析了,提高解析性能.</p>
<p>解析的处理流程:<br>    比如<a target="_blank" rel="noopener" href="http://www.163.com如何解析的/">www.163.com如何解析的</a>.<br>    1. 电脑会查询相对应的IP,首先看电脑的hosts文件是否有相关的配置,如果存在就直接使用,如果没有电脑就会想本地的DNS域名解析服务器(由服务运营上来提供比如电信,联通等,一般也会部署到他们的机房里边)发出一次请求.<br>    2. 本地的DNS收到请求,会查看本地的缓存中是否存在<a target="_blank" rel="noopener" href="http://www.163.com所对应的ip,如果有直接返回,如果没有就会向根域名(根域名是一种高级的域名,全球一共13套)发出一次请求/">www.163.com所对应的ip,如果有直接返回,如果没有就会向根域名(根域名是一种高级的域名,全球一共13套)发出一次请求</a>.<br>    3. 根域名收到请求后不会直接返回<a target="_blank" rel="noopener" href="http://www.163.com的ip,而是看他的顶级域名是多少,这里是.com,他只会返回(返回.com)顶级域名的服务器给本地dns,然后本地dns会访问.com的顶级域名dns服务器/">www.163.com的IP,而是看他的顶级域名是多少,这里是.com,他只会返回(返回.com)顶级域名的服务器给本地DNS,然后本地DNS会访问.com的顶级域名DNS服务器</a>.<br>    4. 顶级域名服务器就会返回常规域名,这里的常规域名是163.com,这里就会返回一个权威域名的服务器,本地DNS就会访问权威域名服务器,他这里有<a target="_blank" rel="noopener" href="http://www.163.com的ip,就会返回他所对应的ip,本地dns拿到ip后就会返回给电脑,我们电脑拿到ip就会与目标服务器进行链接/">www.163.com的ip,就会返回他所对应的ip,本地DNS拿到ip后就会返回给电脑,我们电脑拿到ip就会与目标服务器进行链接</a>.<br>    5. 这就是一次DNS解析的全过程,<br>    6. 总结:<br>        电脑只是对本地域名解析服务器发起了一次请求,递归解析的过程都是DNS服务器帮忙处理,并且每次DNS服务器在拿到结果后,会把相关信息缓存到本地DNS缓存中,这样等下一次有相同的域名来访问的时候,他就会取到一个对应的ip进行访问,这样也能提高解析性能.</p>
<p>DNS服务器除了返回对应的IP还有两个作用:<br>    1. 负载均衡<br>    2. 就近访问:<br>        对于我们的应用为了保证他的高可用,我们一般将代码和数据部署在多个机房,每个机房都有自己的IP,并且这些机房托管在不同的运营商和不同的地域,同时对于我们的用户肯定希望北京的用户就近访问北京的数据中心,上海的用户就近访问上海的数据中心,如果是电信宽带就会访问电信数据中心,联通的就是联通数据中心,这样就能尽可能避免跨地域跨运营商之间的网络延迟,提升访问速度,这就是就近访问.</p>
<pre><code>如何实现就近访问呢?
这里就需要我们的全局负载均衡器(简称GSLB).看一看他的执行方式上例子:
    假设你有多个应用,这个应用穿过多个机房,并且这些机房托管在不同的运营商,用户的域名为file.abc.com,当一个客户端访问这个域名的时候,首先将这个域名转换成IP,所以客户端会向本地的DNS发起一个域名解析请求,跟上班一样,根域名请求.com等级域名,再从顶级服务器得到abc.com,再访问权威域名服务器,为了支持跨地名跨运营商的就近访问,配置的就不是file.abc.com的ip而是配置的是CNAME(别名),本地域名会通过这个CNAME(别名)访问GSLB服务器,请求查看他本地的运营商和地址,就知道用户的运营商和地址是什么了,这样GSLB就会返回一个和用户相同的运营商,并且返回一个最近机房的IP,给本地DNS,本地的DNS再加上IP返回给电脑,电脑拿着这个ip就能访问就近的机房.这样就通过DNS协议完成了高效的访问.</code></pre>
<hr>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">lys-studys</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/posts/37850/">http://example.com/posts/37850/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></div><div class="post_share"><div class="social-share" data-image="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/60234/"><img class="prev-cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">big_data</div></div></a></div><div class="next-post pull-right"><a href="/posts/55244/"><img class="next-cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">hashtable和hashmap</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/posts/40290/" title="Tcp/Ip协议栈"><img class="cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-12-19</div><div class="title">Tcp/Ip协议栈</div></div></a></div><div><a href="/posts/19628/" title="network-of-computer3"><img class="cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-14</div><div class="title">network-of-computer3</div></div></a></div><div><a href="/posts/7734/" title="network_of_computer1"><img class="cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-08</div><div class="title">network_of_computer1</div></div></a></div><div><a href="/posts/35949/" title="network-of-computer2"><img class="cover" data-lazy-src="https://i.loli.net/2020/05/01/gkihqEjXxJ5UZ1C.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-10</div><div class="title">network-of-computer2</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By lys-studys</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">我们相遇不是意外~ <a target="_blank" rel="noopener" href="https://lys-studys.github.io//">blog</a>!</div><div class="icp"><a target="_blank" rel="noopener" href="http://www.beian.miit.gov.cn/state/outPortal/loginPortal.action"><img class="icp-icon" src="/img/icp.png"/><span>粵ICP備xxxx</span></a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    $.getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js', function () {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'K6YAjTUpfqvIIJRgat2mpicY-gzGzoHsz',
      appKey: 'TiK1kxcHhW26MWKdEgTtxWlm',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><canvas class="fireworks"></canvas><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script defer="defer" id="ribbon" src="/js/third-party/canvas-ribbon.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><script defer="defer" id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/third-party/click_heart.js" async="async"></script><script src="/js/third-party/ClickShowText.js" async="async"></script><script>(function(d, w, c) {
    w.ChatraID = '';
    var s = d.createElement('script');
    w[c] = w[c] || function() {
        (w[c].q = w[c].q || []).push(arguments);
    };
    s.async = true;
    s.src = 'https://call.chatra.io/chatra.js';
    if (d.head) d.head.appendChild(s);
})(document, window, 'Chatra');

if (true) {
  var chatBtnFn = () => {
    var chatBtn = document.getElementById("chat_btn")
    chatBtn.addEventListener("click", function(){
      Chatra('openChat')
    });
  }
  chatBtnFn()
} else {
  if (true) {
    function chatBtnHide () {
      Chatra('hide')
    }
    function chatBtnShow () {
      Chatra('show')
    }
  }
}</script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>